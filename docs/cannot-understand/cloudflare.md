# cloudflare 泛播问题
## 场景描述
### 前提
工作时，运维给了一个tls证书和开发测试域名。并且将开发测试域名**泛解析**到服务器上。
然后有个服务是wss使用9300端口进行通信。

### 问题描述
由于域名是泛解析：*.xxx.com，我将a.xxx.com 配置上nginx 监听 443 与 域名
```conf
server {
      

        listen 443 ssl http2;
        server_name a.xxx.com;

        proxy_pass_header Server;

        ssl_certificate cert/local.crt;
        ssl_certificate_key cert/local.key;
		
    }
```
然后用域名访问nginx，没问题，正常访问。

然后正常跑服务，使用ip+端口访问，服务通信正常。

最后使用域名+端口访问，域名连接不通。

## 解决方法
### 问题分析
我一顿操作猛如虎，捣鼓了2个小时，最后发现是网络直接不通，还捣鼓了1个多小时的证书和nginx问题。。。。。（家人们谁懂啊！）

知道是网络不通后，先查询dns解析，windows操作方法：使用cmd输入 nslookup 回车，再输入域名：baidu.com
```bat
nslookup
默认服务器:  dns.google
Address:  8.8.8.8

> baidu.com
服务器:  dns.google
Address:  8.8.8.8

非权威应答:
名称:    baidu.com
Addresses:  39.156.66.10
          110.242.68.66

>
```  
开始查询自己的域名
输入域名查询解析ip，我的a.xxx.com查询出来是
```
          172.67.216.142
          104.21.86.71
```
我一看，这不是我的服务器ip哇！然后去ip138查询，查出来一个 **泛播** ！ 震惊了家人们！！

再继续查询资料，发现 cloudflare泛播 是只支持**特定端口**的！ 家人们谁懂啊

首先，除了常用的 80 和 443 两个标准端口，Cloudflare还支持11个其它端口。Cloudflare总共支持HTTP端口7个，HTTPS端口6个， 分别是：

> **HTTP协议**  
	**80**  
	8080  
	8880  
	2052  
	2082  
	2086  
	2095  

> **HTTPS协议**  
	**443**  
	2053  
	2083  
	2087  
	2096  
	8443  

而我的9300不在这些支持端口中，导致dns解析失败，一直访问异常。
**后来将端口改为支持的2096后，问题解决，解析正常！泪目，捣鼓了2个小时**

[cloudflare资料](https://itlanyan.com/cloudflare-set-origin-port/)

## 总结
## 泛播（Wildcard Broadcasting）与泛解析（Wildcard DNS）的概念与区别

### 泛解析（Wildcard DNS）

#### 概念
泛解析是指在DNS服务器中使用通配符（通常是 `*`）配置，以便任何子域名请求都解析到同一个IP地址。例如，如果在DNS服务器中设置了 `*.example.com` 指向 `192.0.2.1`，那么 `subdomain1.example.com`、`subdomain2.example.com` 以及其他 `*.example.com` 的子域名都会解析到 `192.0.2.1`。

#### 示例
假设域名为 `example.com`，并设置了泛解析：
`*.example.com -> 192.0.2.1`
那么：

- `www.example.com` -> 192.0.2.1
- `blog.example.com` -> 192.0.2.1
- `anything.example.com` -> 192.0.2.1

### 泛播（Wildcard Broadcasting）

#### 概念
泛播是网络层级的一个概念，通常用于广播网络数据包。它是指在一个网络中将数据包发送到所有可能的目的地址。IP广播包括向整个子网发送数据包（广播地址），例如向 `255.255.255.255` 发送数据包，这会在整个本地网络中进行广播。

#### 示例
在局域网中进行广播：

- 广播地址：`192.168.1.255`
- 发送数据包到 `192.168.1.255`，该子网内的所有设备都会收到这个数据包。

### 区别

| 特性          | 泛解析（Wildcard DNS）                            | 泛播（Wildcard Broadcasting）           |
| ------------- | ------------------------------------------------- | -------------------------------------- |
| 应用层级      | DNS层级                                           | 网络层级                                |
| 主要功能      | 将所有子域名指向一个特定的IP地址                   | 将数据包发送到网络中的所有设备         |
| 实现方式      | 通过DNS记录配置                                    | 通过网络协议（如IP广播）实现            |
| 典型使用场景  | 简化子域名管理，确保所有子域名都能正确解析         | 广播网络消息，如局域网中的ARP请求       |
| 配置示例      | `*.example.com -> 192.0.2.1`                      | `192.168.1.255`                        |
| 常见工具      | DNS服务器（如BIND, Cloudflare）                    | 网络设备，操作系统的网络堆栈           |
| 使用环境      | 互联网或局域网中的域名解析                         | 局域网中的数据包传输                   |

### 总结
泛解析和泛播虽然名称相似，但它们适用于不同的技术领域和场景。泛解析主要用于DNS域名解析，帮助将大量子域名指向同一IP地址；而泛播用于网络通信，将数据包发送到网络中的所有设备。
